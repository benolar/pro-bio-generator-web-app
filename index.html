<!DOCTYPE html>
<html lang="en" class="antialiased">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Bio Generator</title>
    <link href="./output.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 5px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #d4d4d8;
            border-radius: 10px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #3f3f46; /* Zinc 700 */
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a1a1aa;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #52525b;
        }
        
        /* Animations */
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-down { animation: fadeInDown 0.3s ease-out; }
        .animate-fade-in-up { animation: fadeInUp 0.4s ease-out; }

        .focus-visible-ring:focus-visible {
            outline: 2px solid #6366f1;
            outline-offset: 2px;
        }
    </style>
</head>
<body class="bg-[#f0f4f9] dark:bg-[#0b0c0d] text-gray-800 dark:text-gray-200 font-sans h-screen overflow-hidden flex transition-colors duration-300">

    <!-- SIDEBAR (History & Nav) -->
    <aside id="app-sidebar" class="fixed inset-y-0 left-0 z-40 w-72 bg-white dark:bg-[#1e1f20] text-gray-600 dark:text-gray-300 transform -translate-x-full md:translate-x-0 transition-all duration-300 ease-in-out flex flex-col border-r border-gray-200 dark:border-gray-800 shadow-2xl">
        <!-- Sidebar Header -->
        <div class="p-5 flex items-center justify-between">
            <div class="flex items-center gap-2 font-bold text-xl tracking-tight text-gray-900 dark:text-white">
                <span class="text-indigo-600 dark:text-indigo-400 text-2xl">âš¡</span> BioGen
            </div>
            <button id="close-sidebar-btn" class="md:hidden text-gray-400 hover:text-gray-900 dark:hover:text-white p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>

        <!-- New Bio Button -->
        <div class="px-4 mb-6">
            <button id="new-bio-btn" class="w-full flex items-center gap-3 px-4 py-3 bg-gray-900 dark:bg-[#2c2d2e] hover:bg-black dark:hover:bg-[#373839] text-white rounded-full text-sm font-medium transition-all border border-transparent dark:border-gray-700 shadow-lg hover:shadow-indigo-500/10 group">
                <span class="bg-white/20 dark:bg-indigo-500/20 p-1 rounded-full transition-colors">
                    <svg class="w-4 h-4 text-indigo-100 dark:text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                </span>
                New Generation
            </button>
        </div>

        <!-- History Label & Search -->
        <div class="px-4 mb-2">
             <div class="relative group">
                <input type="text" id="history-search" placeholder="Search history..." class="w-full bg-gray-100 dark:bg-[#131314] border border-transparent group-hover:border-gray-300 dark:group-hover:border-gray-700 text-gray-800 dark:text-gray-300 text-xs rounded-lg pl-9 pr-3 py-2.5 focus:outline-none focus:border-indigo-500 focus:bg-white dark:focus:bg-black transition-all placeholder-gray-400 dark:placeholder-gray-600">
                <svg class="w-4 h-4 text-gray-400 dark:text-gray-600 absolute left-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
            <div class="mt-4 text-xs font-semibold text-gray-400 dark:text-gray-500 uppercase tracking-wider px-1">Recent History</div>
        </div>

        <!-- History List -->
        <div class="flex-1 overflow-y-auto custom-scrollbar px-2 pb-4">
            <div id="history-list" class="space-y-1">
                 <div class="flex justify-center items-center py-10 text-xs text-gray-500">
                     <svg class="animate-spin h-4 w-4 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                     </svg>
                     <span>Syncing...</span>
                </div>
            </div>
        </div>

        <!-- User Profile / Auth Footer -->
        <div class="p-4 border-t border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-[#151616]">
             <div id="sidebar-auth-container" class="flex items-center justify-between">
                 <!-- Will be populated by JS -->
                 <button id="auth-btn-sidebar" class="w-full text-left text-sm text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white flex items-center gap-3 px-2 py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors">
                    <div class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path></svg>
                    </div>
                    <div>
                        <div class="font-medium">Guest</div>
                        <div class="text-[10px] text-gray-500">Sign in to save</div>
                    </div>
                 </button>
             </div>
        </div>
    </aside>

    <!-- MAIN CONTENT AREA -->
    <main class="flex-1 flex flex-col min-w-0 bg-[#f9fafe] dark:bg-[#0b0c0d] md:rounded-l-[2rem] shadow-2xl overflow-hidden relative md:ml-72 transition-all duration-300 z-0">
        
        <!-- Top Header -->
        <header class="flex items-center justify-between px-6 py-4 bg-white/80 dark:bg-[#1e1f20]/80 backdrop-blur border-b border-gray-100 dark:border-gray-800 z-20 sticky top-0 transition-colors">
            <div class="flex items-center gap-3">
                <button id="toggle-sidebar-btn" class="md:hidden p-2 -ml-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                </button>
                <h1 class="text-lg font-bold text-gray-800 dark:text-white tracking-tight hidden sm:block">Pro Bio Generator <span class="text-[10px] font-normal text-gray-400 dark:text-gray-500 ml-2 px-2 py-0.5 bg-gray-100 dark:bg-gray-800 rounded-full border border-gray-200 dark:border-gray-700">v2.1</span></h1>
                <h1 class="text-lg font-bold text-gray-800 dark:text-white tracking-tight sm:hidden">BioGen</h1>
            </div>

            <div class="flex items-center gap-3">
                <!-- Pro Status -->
                <div id="top-pro-status" class="hidden items-center gap-1.5 bg-amber-50 dark:bg-amber-900/20 text-amber-700 dark:text-amber-400 text-xs font-bold px-3 py-1.5 rounded-full border border-amber-100 dark:border-amber-800 shadow-sm">
                    <span class="text-amber-500">ðŸ‘‘</span> PRO ACTIVE
                </div>
                <button id="top-unlock-btn" class="hidden bg-gray-900 dark:bg-white text-white dark:text-black text-xs font-semibold px-4 py-2 rounded-full hover:bg-black dark:hover:bg-gray-200 transition-colors shadow-lg flex items-center gap-2">
                   Unlock Pro
                </button>

                <!-- Theme Toggle -->
                <button id="theme-toggle-btn" class="p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors focus-visible-ring" title="Toggle Theme">
                    <!-- Sun Icon (for Dark Mode) -->
                    <svg id="theme-icon-sun" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    <!-- Moon Icon (for Light Mode) -->
                    <svg id="theme-icon-moon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                </button>
            </div>
        </header>

        <!-- Scrollable Workspace -->
        <div id="main-scroll" class="flex-1 overflow-y-auto relative custom-scrollbar bg-[#f9fafe] dark:bg-[#0b0c0d] transition-colors">
            <div class="max-w-3xl mx-auto px-4 py-8 md:py-12 flex flex-col min-h-[calc(100vh-100px)]">
                
                <!-- Hero Section -->
                <div class="text-center mb-8 transition-all duration-500 ease-out" id="hero-section">
                    <div class="inline-block p-3 rounded-2xl bg-white dark:bg-[#1e1f20] shadow-sm mb-4 border border-gray-100 dark:border-gray-800 transition-colors">
                        <div class="bg-gradient-to-br from-indigo-500 to-purple-600 w-12 h-12 rounded-xl flex items-center justify-center text-white shadow-inner">
                            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        </div>
                    </div>
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-3 tracking-tight transition-colors">
                        <span class="bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-purple-600 dark:from-indigo-400 dark:to-purple-400">Instant Niche</span> Bios
                    </h2>
                    <p class="text-gray-500 dark:text-gray-400 text-lg max-w-lg mx-auto leading-relaxed transition-colors">Craft the perfect professional or social identity in seconds using advanced AI.</p>
                </div>

                <!-- GENERATOR CONSOLE (The Form) -->
                <div class="bg-white dark:bg-[#1e1f20] rounded-2xl shadow-[0_8px_30px_rgb(0,0,0,0.04)] dark:shadow-none border border-gray-100 dark:border-gray-800 mb-8 relative overflow-visible group transition-all hover:shadow-[0_8px_30px_rgb(0,0,0,0.08)]">
                    
                    <div class="p-6 md:p-8 space-y-6">
                        <!-- Niche Input -->
                        <div class="relative">
                            <label for="niche" class="block text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-1">I am a...</label>
                            <input type="text" id="niche" placeholder="e.g. Freelance Web Developer, Travel Vlogger..." 
                                class="w-full text-lg md:text-xl pb-2 border-b-2 border-gray-100 dark:border-gray-700 focus:border-indigo-500 dark:focus:border-indigo-500 outline-none transition-colors bg-transparent placeholder-gray-300 dark:placeholder-gray-600 text-gray-800 dark:text-gray-100 font-medium">
                        </div>

                        <!-- Controls Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                             <!-- Tone -->
                            <div class="relative">
                                <label for="tone" class="block text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-1.5">Tone</label>
                                <div class="relative">
                                    <select id="tone" class="w-full bg-gray-50 dark:bg-[#2c2d2e] hover:bg-gray-100 dark:hover:bg-[#373839] border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none appearance-none cursor-pointer transition-colors">
                                        <option value="Professional & Authoritative">Professional</option>
                                        <option value="Witty & Humorous">Witty & Fun</option>
                                        <option value="Friendly & Approachable">Friendly</option>
                                        <option value="Minimalist & Concise">Minimalist</option>
                                    </select>
                                    <div class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none text-gray-400">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                    </div>
                                </div>
                            </div>

                            <!-- Platform -->
                            <div class="relative">
                                <label class="block text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-1.5">Platform</label>
                                <select id="platform" class="hidden">
                                    <option value="General" data-pro="false" selected>General</option>
                                    <option value="LinkedIn" data-pro="true">LinkedIn</option>
                                    <option value="X/Twitter" data-pro="true">X/Twitter</option>
                                    <option value="Instagram" data-pro="true">Instagram</option>
                                    <option value="TikTok" data-pro="true">TikTok</option>
                                    <option value="Upwork" data-pro="true">Upwork</option>
                                    <option value="Fiverr" data-pro="true">Fiverr</option>
                                    <option value="Freelancer" data-pro="true">Freelancer</option>
                                    <option value="YouTube" data-pro="true">YouTube</option>
                                </select>
                                <div id="custom-platform-container" class="relative">
                                    <button type="button" id="platform-trigger" class="w-full bg-gray-50 dark:bg-[#2c2d2e] hover:bg-gray-100 dark:hover:bg-[#373839] border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2.5 text-left flex items-center justify-between text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition-colors group/trigger">
                                        <div id="trigger-content" class="flex items-center gap-2 truncate text-gray-700 dark:text-gray-200 font-medium">Select...</div>
                                        <svg id="trigger-chevron" class="w-4 h-4 text-gray-400 group-hover/trigger:text-gray-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                    </button>
                                    <div id="platform-menu" class="hidden absolute z-30 w-full mt-1 bg-white dark:bg-[#1e1f20] border border-gray-200 dark:border-gray-700 rounded-xl shadow-2xl max-h-60 overflow-y-auto custom-scrollbar py-1 origin-top animate-fade-in-down"></div>
                                </div>
                            </div>

                            <!-- Length -->
                            <div class="relative">
                                <label class="block text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-1.5">Length</label>
                                <select id="length" class="hidden">
                                    <option value="short" data-pro="false" selected>Short (Free)</option>
                                    <option value="medium" data-pro="true" disabled>Medium (Pro)</option>
                                    <option value="fixed-long" data-pro="true" disabled>Long (Pro)</option>
                                    <option value="custom" data-pro="true" disabled>Custom (Pro)</option>
                                </select>
                                <div id="custom-length-container" class="relative">
                                     <button type="button" id="length-trigger" class="w-full bg-gray-50 dark:bg-[#2c2d2e] hover:bg-gray-100 dark:hover:bg-[#373839] border border-gray-200 dark:border-gray-700 rounded-xl px-3 py-2.5 text-left flex items-center justify-between text-sm focus:ring-2 focus:ring-indigo-500 outline-none transition-colors group/trigger">
                                        <div id="length-trigger-content" class="flex items-center gap-2 truncate text-gray-700 dark:text-gray-200 font-medium">Select...</div>
                                        <svg id="length-trigger-chevron" class="w-4 h-4 text-gray-400 group-hover/trigger:text-gray-600 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                    </button>
                                    <div id="length-menu" class="hidden absolute z-30 w-full mt-1 bg-white dark:bg-[#1e1f20] border border-gray-200 dark:border-gray-700 rounded-xl shadow-2xl max-h-60 overflow-y-auto custom-scrollbar py-1 origin-top animate-fade-in-down"></div>
                                </div>
                            </div>
                        </div>

                         <!-- Custom Length Input Slider -->
                        <div id="custom-length-group" class="hidden bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 p-4 rounded-xl border border-indigo-100 dark:border-indigo-500/20 animate-fade-in-down">
                             <div class="flex justify-between items-center mb-2">
                                <label for="custom-length" class="text-xs font-bold text-indigo-700 dark:text-indigo-300 uppercase">Character Limit</label>
                                <span id="custom-length-feedback" class="text-xs font-mono font-bold text-indigo-600 dark:text-indigo-300 bg-white dark:bg-transparent px-2 py-0.5 rounded border border-indigo-100 dark:border-indigo-500/30">500</span>
                             </div>
                             <input type="range" id="custom-length" min="300" max="1000" step="10" value="500" class="w-full h-2 bg-indigo-200 dark:bg-indigo-800 rounded-lg appearance-none cursor-pointer accent-indigo-600 dark:accent-indigo-500 hover:accent-indigo-700 transition-all">
                             <div class="flex justify-between text-[10px] text-indigo-400 mt-1 font-medium">
                                 <span>300</span>
                                 <span>1000</span>
                             </div>
                        </div>

                        <!-- Goals Input -->
                        <div>
                            <label for="goals" class="block text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-1">Keywords / Goals</label>
                             <input type="text" id="goals" placeholder="e.g. Hiring now, link in bio, minimalistic..." 
                                class="w-full p-3 bg-gray-50 dark:bg-[#2c2d2e] border border-gray-200 dark:border-gray-700 rounded-xl text-sm font-medium text-gray-700 dark:text-gray-200 focus:ring-2 focus:ring-indigo-500 focus:bg-white dark:focus:bg-[#131314] outline-none transition-colors placeholder-gray-400 dark:placeholder-gray-500">
                        </div>

                        <!-- Generate Button -->
                        <button id="generate-button" class="w-full bg-gray-900 dark:bg-white hover:bg-black dark:hover:bg-gray-200 text-white dark:text-gray-900 font-bold py-4 rounded-xl transition-all transform active:scale-[0.99] shadow-lg hover:shadow-xl flex items-center justify-center gap-2 group focus-visible-ring">
                             <span>Generate Bios</span>
                             <div class="bg-white/20 dark:bg-black/10 rounded p-0.5 group-hover:translate-x-1 transition-transform">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                             </div>
                             <svg id="loading-spinner" class="animate-spin h-5 w-5 text-white dark:text-gray-900 hidden ml-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                        </button>

                        <!-- Hidden inputs needed for logic -->
                        <div id="user-info" class="hidden"></div>
                    </div>
                </div>

                <!-- RESULTS AREA -->
                <div id="output-area" class="hidden animate-fade-in-up pb-10">
                     <div class="flex items-center justify-between mb-4 px-2">
                        <h3 class="text-sm font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider">Generated Options</h3>
                         <div id="copy-message" class="hidden bg-emerald-100 text-emerald-700 text-xs font-bold px-3 py-1 rounded-full animate-pulse">Copied!</div>
                     </div>
                     <div id="bio-results" class="grid grid-cols-1 gap-4">
                         <!-- Results cards injected here -->
                     </div>
                </div>

                <!-- Spacer for scrolling -->
                <div class="h-10"></div>
            </div>
        </div>
    </main>

    <!-- AUTH MODAL -->
    <div id="auth-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] hidden flex items-center justify-center transition-opacity opacity-0" aria-modal="true" role="dialog">
        <div class="bg-white dark:bg-[#1e1f20] rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden transform transition-all scale-95" id="auth-modal-panel">
            <div class="bg-gray-50 dark:bg-[#151616] px-6 py-4 border-b border-gray-100 dark:border-gray-800 flex justify-between items-center">
                <h3 class="text-lg font-bold text-gray-800 dark:text-white" id="auth-modal-title">Sign In</h3>
                <button id="close-auth-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-white transition-colors focus-visible-ring rounded-md">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="p-6 space-y-6">
                <button id="google-auth-btn" class="w-full bg-white dark:bg-[#2c2d2e] border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-white font-medium py-2.5 px-4 rounded-xl hover:bg-gray-50 dark:hover:bg-[#373839] transition-all flex items-center justify-center gap-3 shadow-sm focus-visible-ring">
                    <svg class="w-5 h-5" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.21H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
                    <span id="google-btn-text">Continue with Google</span>
                </button>
                <div class="relative flex items-center py-2">
                    <div class="flex-grow border-t border-gray-200 dark:border-gray-700"></div>
                    <span class="flex-shrink-0 mx-4 text-gray-400 text-xs uppercase tracking-wider">Or with email</span>
                    <div class="flex-grow border-t border-gray-200 dark:border-gray-700"></div>
                </div>
                <form id="email-auth-form" class="space-y-4">
                    <div class="space-y-1">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Email Address</label>
                        <input type="email" id="auth-email" required class="w-full px-4 py-2 bg-white dark:bg-[#131314] text-gray-900 dark:text-white border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition-all" placeholder="you@example.com">
                    </div>
                    <div class="space-y-1">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">Password</label>
                        <input type="password" id="auth-password" required minlength="6" class="w-full px-4 py-2 bg-white dark:bg-[#131314] text-gray-900 dark:text-white border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition-all" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <button type="submit" id="email-submit-btn" class="w-full bg-indigo-600 text-white font-semibold py-2.5 rounded-xl hover:bg-indigo-700 focus:ring-4 focus:ring-indigo-100 dark:focus:ring-indigo-900 transition-all shadow-lg shadow-indigo-200 dark:shadow-none focus-visible-ring">Sign In</button>
                </form>
            </div>
            <div class="bg-gray-50 dark:bg-[#151616] px-6 py-4 text-center text-sm text-gray-600 dark:text-gray-400">
                <span id="auth-mode-message">Don't have an account?</span>
                <button id="toggle-auth-mode" class="text-indigo-600 dark:text-indigo-400 font-bold hover:underline ml-1 focus-visible-ring rounded">Create one</button>
            </div>
        </div>
    </div>

    <!-- PAYMENT MODAL -->
    <div id="payment-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-[60] hidden flex items-center justify-center transition-opacity opacity-0" aria-modal="true" role="dialog">
        <div class="bg-white dark:bg-[#1e1f20] rounded-2xl shadow-2xl w-full max-w-sm mx-4 overflow-hidden transform transition-all scale-95" id="payment-modal-panel">
            <div class="bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 px-6 py-5 border-b border-amber-100 dark:border-amber-800">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-amber-800 dark:text-amber-500 flex items-center gap-2">
                        <span>ðŸ‘‘</span> Unlock Pro
                    </h3>
                    <button id="close-payment-modal" class="text-amber-700 dark:text-amber-400 hover:text-amber-900 dark:hover:text-amber-300 bg-amber-100 dark:bg-amber-900/40 hover:bg-amber-200 dark:hover:bg-amber-900/60 rounded-lg p-1 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
            </div>
            <div class="p-6 space-y-5">
                <div class="bg-amber-50/50 dark:bg-amber-900/10 p-4 rounded-xl border border-amber-100 dark:border-amber-800 space-y-3">
                    <div class="flex justify-between items-center border-b border-amber-200/50 dark:border-amber-800 pb-2">
                        <span class="text-gray-600 dark:text-gray-400 text-sm font-medium">Lifetime Access</span>
                        <span class="font-bold text-gray-800 dark:text-gray-200">Premium</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-500 dark:text-gray-400 text-xs">One-time payment</span>
                        <span class="font-black text-3xl text-amber-600 dark:text-amber-500">$2.99</span>
                    </div>
                </div>
                <ul class="space-y-3 text-sm text-gray-600 dark:text-gray-300 px-2">
                    <li class="flex items-center gap-3">
                        <div class="bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-full p-0.5"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>
                        <span>Unlock <b>8+ Social Platforms</b></span>
                    </li>
                    <li class="flex items-center gap-3">
                        <div class="bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-full p-0.5"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>
                        <span>Longer Bios (up to 1000 chars)</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <div class="bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-full p-0.5"><svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div>
                        <span>No Monthly Subscription</span>
                    </li>
                </ul>
                <button id="confirm-payment-btn" class="w-full bg-gray-900 dark:bg-white text-white dark:text-black font-bold py-3.5 rounded-xl shadow-lg hover:bg-black dark:hover:bg-gray-200 transition-all transform active:scale-95 flex items-center justify-center gap-2">
                    <span>Proceed to Checkout</span>
                    <svg class="w-4 h-4 text-amber-300 dark:text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                </button>
                 <button id="cancel-payment-btn" class="w-full text-xs text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 font-medium py-2">No thanks, I'll stay free</button>
            </div>
        </div>
    </div>
    
    <!-- DELETE MODAL -->
    <div id="delete-confirmation-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[60] hidden flex items-center justify-center transition-opacity opacity-0" aria-modal="true" role="dialog">
        <div class="bg-white dark:bg-[#1e1f20] rounded-2xl shadow-2xl w-full max-w-xs mx-4 overflow-hidden transform transition-all scale-95" id="delete-modal-panel">
            <div class="p-6 text-center">
                <div class="w-12 h-12 bg-red-100 dark:bg-red-900/20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-6 h-6 text-red-600 dark:text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                </div>
                <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2">Delete Bio?</h3>
                <div class="flex gap-3 mt-6">
                    <button id="cancel-delete-btn" class="flex-1 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 font-semibold py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">Cancel</button>
                    <button id="confirm-delete-btn" class="flex-1 bg-red-600 text-white font-semibold py-2 rounded-lg hover:bg-red-700 transition-colors shadow-lg shadow-red-200 dark:shadow-none">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Message -->
    <div id="message-box" class="fixed bottom-6 right-6 px-6 py-3 rounded-xl shadow-2xl text-white font-medium transition-all duration-300 opacity-0 translate-y-4 pointer-events-none z-[70] flex items-center gap-3"></div>

    <!-- Tooltip -->
    <div id="pro-tooltip" class="fixed z-[80] hidden bg-gray-900 dark:bg-gray-700 text-white text-xs font-medium rounded py-1.5 px-3 shadow-xl pointer-events-none opacity-0 transition-opacity duration-200">
        <span id="pro-tooltip-text"></span>
    </div>

    <script type="module">
        // FIREBASE CONFIG
        const FIREBASE_CLIENT_CONFIG = {
            apiKey: "AIzaSyAAqqENNvQzrUdMFcjEJsG2iygrQWNWS0A",
            authDomain: "pro-tools-web-app.firebaseapp.com",
            projectId: "pro-tools-web-app",
            storageBucket: "pro-tools-web-app.firebasestorage.app",
            messagingSenderId: "146517824837",
            appId: "1:146517824837:web:12d1c042f8493b1bab1a2c",
            measurementId: "G-6LYSEGKE8V"
        };

        const canvasFirebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const isCanvasConfigValid = canvasFirebaseConfig && Object.keys(canvasFirebaseConfig).length > 0 && canvasFirebaseConfig.projectId;
        const firebaseConfig = isCanvasConfigValid ? canvasFirebaseConfig : FIREBASE_CLIENT_CONFIG;
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : firebaseConfig.projectId || 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserSessionPersistence,
            GoogleAuthProvider, signInWithPopup, linkWithPopup, signOut, EmailAuthProvider, linkWithCredential,
            createUserWithEmailAndPassword, signInWithEmailAndPassword
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, serverTimestamp, limit, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // GLOBAL STATE
        let app, db, auth, userId = null;
        let isAuthReady = false;
        let isPro = false;
        let isRegisterMode = false;
        let allHistoryBios = [];

        // UI REFERENCES
        const generateButton = document.getElementById('generate-button');
        const loadingSpinner = document.getElementById('loading-spinner');
        const outputArea = document.getElementById('output-area');
        const bioResults = document.getElementById('bio-results');
        const nicheInput = document.getElementById('niche');
        const toneSelect = document.getElementById('tone');
        const platformSelect = document.getElementById('platform');
        const lengthSelect = document.getElementById('length');
        const goalsInput = document.getElementById('goals');
        const customLengthGroup = document.getElementById('custom-length-group');
        const customLengthInput = document.getElementById('custom-length');
        const customLengthFeedback = document.getElementById('custom-length-feedback');
        const copyMessage = document.getElementById('copy-message');
        const historyList = document.getElementById('history-list');
        const historySearchInput = document.getElementById('history-search');
        
        // Sidebar
        const sidebar = document.getElementById('app-sidebar');
        const toggleSidebarBtn = document.getElementById('toggle-sidebar-btn');
        const closeSidebarBtn = document.getElementById('close-sidebar-btn');
        const sidebarAuthContainer = document.getElementById('sidebar-auth-container');
        const newBioBtn = document.getElementById('new-bio-btn');
        const heroSection = document.getElementById('hero-section');

        // Auth UI
        const authModal = document.getElementById('auth-modal');
        const authModalPanel = document.getElementById('auth-modal-panel');
        const closeAuthModalBtn = document.getElementById('close-auth-modal');
        const googleAuthBtn = document.getElementById('google-auth-btn');
        const emailAuthForm = document.getElementById('email-auth-form');
        const toggleAuthModeBtn = document.getElementById('toggle-auth-mode');

        // Pro UI
        const topProStatus = document.getElementById('top-pro-status');
        const topUnlockBtn = document.getElementById('top-unlock-btn');
        const paymentModal = document.getElementById('payment-modal');
        const paymentModalPanel = document.getElementById('payment-modal-panel');
        const closePaymentModalBtn = document.getElementById('close-payment-modal');
        const cancelPaymentBtn = document.getElementById('cancel-payment-btn');
        const confirmPaymentBtn = document.getElementById('confirm-payment-btn');

        // Delete UI
        const deleteModal = document.getElementById('delete-confirmation-modal');
        const deleteModalPanel = document.getElementById('delete-modal-panel');
        const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');

        // Tooltip
        const tooltip = document.getElementById('pro-tooltip');
        const tooltipText = document.getElementById('pro-tooltip-text');

        // Theme UI
        const themeToggleBtn = document.getElementById('theme-toggle-btn');
        const themeIconSun = document.getElementById('theme-icon-sun');
        const themeIconMoon = document.getElementById('theme-icon-moon');
        const htmlElement = document.documentElement;

        // CONSTANTS
        const API_PROXY_URL = '/api/generate-bio';
        const CREATE_CHECKOUT_URL = '/api/create-checkout';

        // --- THEME LOGIC ---
        function updateTheme(isDark) {
            if (isDark) {
                htmlElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                themeIconSun.classList.remove('hidden');
                themeIconMoon.classList.add('hidden');
            } else {
                htmlElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                themeIconSun.classList.add('hidden');
                themeIconMoon.classList.remove('hidden');
            }
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const sysDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const isDark = savedTheme === 'dark' || (!savedTheme && sysDark);
            updateTheme(isDark);
        }

        themeToggleBtn.addEventListener('click', () => {
            const isDark = htmlElement.classList.contains('dark');
            updateTheme(!isDark);
        });
        
        initTheme();


        // --- SIDEBAR TOGGLE ---
        function toggleSidebar() {
            const isClosed = sidebar.classList.contains('-translate-x-full');
            if (isClosed) {
                sidebar.classList.remove('-translate-x-full');
            } else {
                sidebar.classList.add('-translate-x-full');
            }
        }
        toggleSidebarBtn.addEventListener('click', toggleSidebar);
        closeSidebarBtn.addEventListener('click', toggleSidebar);

        newBioBtn.addEventListener('click', () => {
            nicheInput.value = '';
            goalsInput.value = '';
            outputArea.classList.add('hidden');
            heroSection.classList.remove('hidden');
            if(window.innerWidth < 768) toggleSidebar();
            nicheInput.focus();
        });

        // --- XSS HELPERS ---
        function escapeHtml(text) {
            if (!text) return '';
            return text.replace(/[&<>"']/g, function(m) {
                return {'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'}[m];
            });
        }

        function showMessage(text, isError = false) {
            const box = document.getElementById('message-box');
            box.textContent = text;
            box.className = `fixed bottom-6 right-6 px-6 py-3 rounded-xl shadow-2xl text-white font-medium transition-all duration-300 z-[70] flex items-center gap-3 ${isError ? 'bg-red-500' : 'bg-gray-900 dark:bg-gray-700'}`;
            box.classList.remove('opacity-0', 'translate-y-4', 'pointer-events-none');
            
            setTimeout(() => {
                box.classList.add('opacity-0', 'translate-y-4', 'pointer-events-none');
            }, 3000);
        }

        // --- TOOLTIP ---
        function showTooltip(e, text) {
            if (!text) return;
            tooltipText.textContent = text;
            tooltip.classList.remove('hidden');
            void tooltip.offsetWidth; 
            tooltip.classList.remove('opacity-0');
            
            const targetRect = e.currentTarget.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();
            const top = targetRect.top - tooltipRect.height - 8;
            const left = targetRect.left + (targetRect.width / 2) - (tooltipRect.width / 2);
            tooltip.style.top = `${top}px`;
            tooltip.style.left = `${left}px`;
        }
        function hideTooltip() {
            tooltip.classList.add('opacity-0');
            setTimeout(() => { if(tooltip.classList.contains('opacity-0')) tooltip.classList.add('hidden'); }, 200);
        }

        // --- CUSTOM DROPDOWNS ---
        const PLATFORM_ICONS = {
            'General': '<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>',
            'LinkedIn': '<path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>',
            'X/Twitter': '<path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>',
            'Instagram': '<path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.012 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.948-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>'
        };
        const LOCK_ICON = '<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/></svg>';
        
        const platformTrigger = document.getElementById('platform-trigger');
        const platformMenu = document.getElementById('platform-menu');
        const lengthTrigger = document.getElementById('length-trigger');
        const lengthMenu = document.getElementById('length-menu');

        function initCustomDropdowns() {
            setupDropdown(platformTrigger, platformMenu, platformSelect, renderPlatformOptions);
            setupDropdown(lengthTrigger, lengthMenu, lengthSelect, renderLengthOptions);
        }

        function setupDropdown(trigger, menu, select, renderFn) {
            trigger.addEventListener('click', (e) => {
                e.stopPropagation();
                const isHidden = menu.classList.contains('hidden');
                closeAllDropdowns();
                if(isHidden) menu.classList.remove('hidden');
            });
            document.addEventListener('click', (e) => {
                if(!trigger.contains(e.target) && !menu.contains(e.target)) menu.classList.add('hidden');
            });
            renderFn(menu, select, trigger);
        }

        function closeAllDropdowns() {
            platformMenu.classList.add('hidden');
            lengthMenu.classList.add('hidden');
        }

        function renderPlatformOptions(menu, select, trigger) {
            menu.innerHTML = '';
            Array.from(select.options).forEach(opt => {
                const val = opt.value;
                const isProOpt = opt.dataset.pro === 'true';
                const isDisabled = opt.disabled;
                const isSelected = opt.selected;
                const iconPath = PLATFORM_ICONS[val] || PLATFORM_ICONS['General'];
                
                const div = document.createElement('div');
                div.className = `flex items-center px-3 py-2.5 cursor-pointer text-sm transition-colors ${isSelected ? 'bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300' : 'hover:bg-gray-50 dark:hover:bg-[#2c2d2e] text-gray-700 dark:text-gray-200'} ${isDisabled ? 'opacity-75' : ''}`;
                
                let suffix = '';
                if(isProOpt) {
                    suffix = isDisabled ? `<div class="ml-auto flex items-center gap-1 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-500 text-[10px] font-bold px-1.5 py-0.5 rounded border border-amber-200 dark:border-amber-800">${LOCK_ICON} PRO</div>` 
                                        : `<div class="ml-auto flex items-center gap-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-[10px] font-bold px-1.5 py-0.5 rounded border border-green-200 dark:border-green-800">FREE</div>`;
                }

                div.innerHTML = `
                    <div class="w-6 h-6 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mr-3 text-gray-600 dark:text-gray-300">
                        <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 24 24">${iconPath}</svg>
                    </div>
                    <span class="font-medium">${val}</span>
                    ${suffix}
                `;

                div.onclick = (e) => {
                    if(isDisabled) { openPaymentModal(); return; }
                    select.value = val;
                    updateTrigger(trigger, val, iconPath);
                    renderPlatformOptions(menu, select, trigger);
                    closeAllDropdowns();
                };
                menu.appendChild(div);
            });
            // Init trigger
            const currentOpt = select.options[select.selectedIndex];
            updateTrigger(trigger, currentOpt.value, PLATFORM_ICONS[currentOpt.value] || PLATFORM_ICONS['General']);
        }

        function renderLengthOptions(menu, select, trigger) {
            menu.innerHTML = '';
            Array.from(select.options).forEach(opt => {
                const val = opt.value;
                const isProOpt = opt.dataset.pro === 'true';
                const isDisabled = opt.disabled;
                const isSelected = opt.selected;
                
                const div = document.createElement('div');
                div.className = `flex items-center px-3 py-2.5 cursor-pointer text-sm transition-colors ${isSelected ? 'bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300' : 'hover:bg-gray-50 dark:hover:bg-[#2c2d2e] text-gray-700 dark:text-gray-200'} ${isDisabled ? 'opacity-75' : ''}`;
                
                let suffix = isProOpt 
                    ? (isDisabled ? `<div class="ml-auto flex items-center gap-1 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-500 text-[10px] font-bold px-1.5 py-0.5 rounded border border-amber-200 dark:border-amber-800">${LOCK_ICON} PRO</div>` : `<div class="ml-auto bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-[10px] font-bold px-1.5 py-0.5 rounded border border-green-200 dark:border-green-800">FREE</div>`)
                    : '';

                div.innerHTML = `<span class="font-medium">${opt.text}</span>${suffix}`;
                
                div.onclick = (e) => {
                    if(isDisabled) { openPaymentModal(); return; }
                    select.value = val;
                    select.dispatchEvent(new Event('change')); // Trigger change for listeners
                    updateTrigger(trigger, opt.text, null);
                    renderLengthOptions(menu, select, trigger);
                    closeAllDropdowns();
                };
                menu.appendChild(div);
            });
            const currentOpt = select.options[select.selectedIndex];
            updateTrigger(trigger, currentOpt.text, null);
        }

        function updateTrigger(trigger, text, iconPath) {
            const content = trigger.querySelector('div[id$="content"]');
            if(iconPath) {
                content.innerHTML = `<svg class="w-4 h-4 text-gray-500 dark:text-gray-400" fill="currentColor" viewBox="0 0 24 24">${iconPath}</svg> <span>${text}</span>`;
            } else {
                content.textContent = text;
            }
        }

        // --- AUTH & MODALS LOGIC ---
        function openAuthModal(register = false) {
            isRegisterMode = register;
            updateAuthModalUI();
            authModal.classList.remove('hidden');
            requestAnimationFrame(() => {
                authModal.classList.remove('opacity-0');
                authModalPanel.classList.remove('scale-95');
                authModalPanel.classList.add('scale-100');
            });
        }
        function closeAuthModal() {
            authModal.classList.add('opacity-0');
            authModalPanel.classList.remove('scale-100');
            authModalPanel.classList.add('scale-95');
            setTimeout(() => authModal.classList.add('hidden'), 200);
        }
        function updateAuthModalUI() {
            const title = document.getElementById('auth-modal-title');
            const submitBtn = document.getElementById('email-submit-btn');
            const modeMsg = document.getElementById('auth-mode-message');
            const googleBtnText = document.getElementById('google-btn-text');
            const user = auth.currentUser;
            const isAnon = user && user.isAnonymous;

            if (isRegisterMode) {
                title.textContent = isAnon ? "Save Account" : "Create Account";
                submitBtn.textContent = isAnon ? "Link Email" : "Sign Up";
                modeMsg.textContent = "Already have an account?";
                toggleAuthModeBtn.textContent = "Sign In";
                googleBtnText.textContent = isAnon ? "Link with Google" : "Sign up with Google";
            } else {
                title.textContent = "Sign In";
                submitBtn.textContent = "Sign In";
                modeMsg.textContent = "Don't have an account?";
                toggleAuthModeBtn.textContent = "Create one";
                googleBtnText.textContent = "Sign in with Google";
            }
        }
        closeAuthModalBtn.onclick = closeAuthModal;
        toggleAuthModeBtn.onclick = () => { isRegisterMode = !isRegisterMode; updateAuthModalUI(); };
        authModal.onclick = (e) => { if(e.target === authModal) closeAuthModal(); };

        // PAYMENT MODAL
        function openPaymentModal() {
             paymentModal.classList.remove('hidden');
             requestAnimationFrame(() => {
                paymentModal.classList.remove('opacity-0');
                paymentModalPanel.classList.remove('scale-95');
                paymentModalPanel.classList.add('scale-100');
            });
        }
        function closePaymentModal() {
            paymentModal.classList.add('opacity-0');
            paymentModalPanel.classList.remove('scale-100');
            paymentModalPanel.classList.add('scale-95');
            setTimeout(() => paymentModal.classList.add('hidden'), 200);
        }
        [closePaymentModalBtn, cancelPaymentBtn, topUnlockBtn].forEach(el => el?.addEventListener('click', el === topUnlockBtn ? openPaymentModal : closePaymentModal));
        paymentModal.onclick = (e) => { if(e.target === paymentModal) closePaymentModal(); };

        // DELETE MODAL
        let bioIdToDelete = null;
        function openDeleteModal(id) {
            bioIdToDelete = id;
            deleteModal.classList.remove('hidden');
            requestAnimationFrame(() => {
                deleteModal.classList.remove('opacity-0');
                deleteModalPanel.classList.remove('scale-95');
                deleteModalPanel.classList.add('scale-100');
            });
        }
        function closeDeleteModal() {
            deleteModal.classList.add('opacity-0');
            deleteModalPanel.classList.remove('scale-100');
            deleteModalPanel.classList.add('scale-95');
            setTimeout(() => deleteModal.classList.add('hidden'), 200);
        }
        cancelDeleteBtn.onclick = closeDeleteModal;
        deleteModal.onclick = (e) => { if(e.target === deleteModal) closeDeleteModal(); };
        confirmDeleteBtn.onclick = async () => {
            if (!bioIdToDelete || !userId) return;
            const originalText = confirmDeleteBtn.textContent;
            confirmDeleteBtn.textContent = "Deleting...";
            try {
                await deleteDoc(doc(db, `artifacts/${appId}/users/${userId}/bios`, bioIdToDelete));
                showMessage("Bio deleted.");
            } catch (e) {
                console.error(e);
                showMessage("Delete failed.", true);
            } finally {
                confirmDeleteBtn.textContent = originalText;
                closeDeleteModal();
            }
        };

        // --- FIREBASE INIT & AUTH ---
        if (firebaseConfig.projectId) {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            (async () => {
                await setPersistence(auth, browserSessionPersistence);
                if (!auth.currentUser && !initialAuthToken) signInAnonymously(auth);
            })();

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    userId = user.uid;
                    isAuthReady = true;
                    updateAuthUI(user);
                    loadHistory();
                    listenToProStatus();
                }
            });
        }

        function updateAuthUI(user) {
            sidebarAuthContainer.innerHTML = '';
            
            if (user.isAnonymous) {
                sidebarAuthContainer.innerHTML = `
                    <button id="auth-btn-sidebar" class="w-full text-left flex items-center gap-3 px-2 py-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors group">
                        <div class="w-9 h-9 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-gray-400 group-hover:text-gray-600 dark:group-hover:text-white dark:group-hover:bg-gray-600 transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                        </div>
                        <div class="flex-1">
                            <div class="text-sm font-medium text-gray-700 dark:text-gray-200">Guest User</div>
                            <div class="text-[10px] text-gray-500 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">Sign in to sync history</div>
                        </div>
                    </button>
                `;
                document.getElementById('auth-btn-sidebar').onclick = () => openAuthModal(true);
            } else {
                const name = user.displayName || user.email.split('@')[0];
                sidebarAuthContainer.innerHTML = `
                    <div class="flex items-center justify-between w-full">
                        <div class="flex items-center gap-3">
                             <div class="w-9 h-9 rounded-full bg-indigo-100 dark:bg-indigo-900/50 border border-indigo-200 dark:border-indigo-500/30 flex items-center justify-center text-indigo-600 dark:text-indigo-200 font-bold text-sm">
                                ${name.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-700 dark:text-gray-200 truncate max-w-[100px]">${name}</div>
                                <div class="text-[10px] text-gray-500">Free Plan</div>
                            </div>
                        </div>
                        <button id="sign-out-btn" class="text-gray-500 hover:text-red-500 dark:hover:text-red-400 p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-800 transition-colors" title="Sign Out">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                        </button>
                    </div>
                `;
                document.getElementById('sign-out-btn').onclick = () => signOut(auth).then(()=>window.location.reload());
                closeAuthModal();
            }
        }

        // --- AUTH ACTIONS ---
        const googleProvider = new GoogleAuthProvider();
        async function handleGoogleAuth() {
            try {
                const user = auth.currentUser;
                if (user && user.isAnonymous) await linkWithPopup(user, googleProvider);
                else await signInWithPopup(auth, googleProvider);
                closeAuthModal();
            } catch (e) {
                if (e.code === 'auth/credential-already-in-use') {
                     if(confirm("Account exists. Switch? (Guest data lost)")) await signInWithPopup(auth, googleProvider);
                } else showMessage(e.message, true);
            }
        }
        googleAuthBtn.onclick = handleGoogleAuth;
        
        emailAuthForm.onsubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const btn = document.getElementById('email-submit-btn');
            btn.textContent = 'Processing...';
            try {
                const user = auth.currentUser;
                if (isRegisterMode) {
                    if (user && user.isAnonymous) await linkWithCredential(user, EmailAuthProvider.credential(email, password));
                    else await createUserWithEmailAndPassword(auth, email, password);
                } else {
                    await signInWithEmailAndPassword(auth, email, password);
                }
                closeAuthModal();
                showMessage("Success!");
            } catch (e) {
                showMessage(e.message, true);
            } finally {
                btn.textContent = 'Sign In';
            }
        };

        // --- HISTORY LOGIC ---
        function loadHistory() {
            const historyRef = collection(db, `artifacts/${appId}/users/${userId}/bios`);
            const q = query(historyRef, limit(50));
            
            onSnapshot(q, (snapshot) => {
                allHistoryBios = [];
                snapshot.forEach(doc => allHistoryBios.push({id: doc.id, ...doc.data()}));
                allHistoryBios.sort((a,b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));
                renderHistory(allHistoryBios);
            });
        }

        function renderHistory(bios) {
            historyList.innerHTML = '';
            if (bios.length === 0) {
                historyList.innerHTML = '<div class="px-4 py-6 text-xs text-gray-500 dark:text-gray-500 italic text-center">No saved bios yet.</div>';
                return;
            }

            bios.forEach(item => {
                const div = document.createElement('div');
                div.className = 'group relative p-3 rounded-xl hover:bg-gray-100 dark:hover:bg-[#2c2d2e] cursor-pointer transition-colors border border-transparent';
                div.innerHTML = `
                    <div class="text-sm text-gray-700 dark:text-gray-300 font-medium line-clamp-2 pr-6">${escapeHtml(item.bio)}</div>
                    <div class="flex items-center gap-2 mt-1.5">
                        <span class="text-[10px] text-gray-500 dark:text-gray-400 bg-gray-200 dark:bg-[#1a1b1c] px-1.5 py-0.5 rounded border border-gray-300 dark:border-gray-800">${escapeHtml(item.platform || 'General')}</span>
                        <span class="text-[10px] text-gray-400 dark:text-gray-500">${escapeHtml(item.niche || '').substring(0, 15)}...</span>
                    </div>
                    <button class="delete-btn absolute top-2 right-2 p-1 text-gray-400 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded opacity-0 group-hover:opacity-100 transition-all" title="Delete">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    </button>
                `;
                
                div.onclick = (e) => {
                    if(e.target.closest('.delete-btn')) {
                        e.stopPropagation();
                        openDeleteModal(item.id);
                    } else {
                        // Populate form or show result? For now copy.
                        copyToClipboard(item.bio, true);
                    }
                };
                historyList.appendChild(div);
            });
        }
        
        historySearchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = allHistoryBios.filter(b => 
                (b.bio && b.bio.toLowerCase().includes(term)) || 
                (b.niche && b.niche.toLowerCase().includes(term))
            );
            renderHistory(filtered);
        });

        // --- PRO LOGIC ---
        function listenToProStatus() {
            onSnapshot(doc(db, `artifacts/${appId}/users/${userId}/profile/status`), (doc) => {
                const data = doc.data();
                isPro = data && data.isPro === true;
                updateProUI();
            });
        }
        
        function updateProUI() {
            if(isPro) {
                topProStatus.classList.remove('hidden');
                topProStatus.classList.add('flex');
                topUnlockBtn.classList.add('hidden');
            } else {
                topProStatus.classList.add('hidden');
                topProStatus.classList.remove('flex');
                topUnlockBtn.classList.remove('hidden');
            }

            // Update select options availability
            document.querySelectorAll('option[data-pro="true"]').forEach(opt => {
                opt.disabled = !isPro;
                if(isPro) opt.text = opt.text.replace(' (Pro)', ''); 
            });
            
            // Reset if selected locked option
            if(!isPro) {
                if(lengthSelect.options[lengthSelect.selectedIndex].disabled) lengthSelect.value = 'short';
                if(platformSelect.options[platformSelect.selectedIndex].disabled) platformSelect.value = 'General';
            }
            
            // Update custom slider visibility
            const isCustom = lengthSelect.value === 'custom' && isPro;
            customLengthGroup.classList.toggle('hidden', !isCustom);

            initCustomDropdowns(); // Refresh dropdowns UI
        }

        lengthSelect.addEventListener('change', () => {
             const isCustom = lengthSelect.value === 'custom' && isPro;
             customLengthGroup.classList.toggle('hidden', !isCustom);
        });
        customLengthInput.addEventListener('input', (e) => customLengthFeedback.textContent = e.target.value);

        // --- PAYMENT ---
        confirmPaymentBtn.onclick = async () => {
            if (!userId) return;
            const btnHtml = confirmPaymentBtn.innerHTML;
            confirmPaymentBtn.disabled = true;
            confirmPaymentBtn.innerHTML = 'Connecting...';
            
            try {
                const res = await fetch(CREATE_CHECKOUT_URL, {
                    method: 'POST', headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({ userId, originUrl: window.location.href })
                });
                const data = await res.json();
                if(data.url) window.location.href = data.url;
                else throw new Error(data.error);
            } catch (e) {
                showMessage("Payment init failed: " + e.message, true);
                confirmPaymentBtn.disabled = false;
                confirmPaymentBtn.innerHTML = btnHtml;
            }
        };

        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('payment') === 'success') {
                showMessage("Payment Successful! Welcome to Pro.", false);
                window.history.replaceState(null, '', window.location.pathname);
            }
            initCustomDropdowns();
        };

        // --- GENERATION ---
        generateButton.onclick = async () => {
            if (!isAuthReady) { showMessage("Wait for initialization...", true); return; }
            
            const niche = nicheInput.value.trim();
            const tone = toneSelect.value;
            const platform = platformSelect.value;
            const length = lengthSelect.value;
            const goals = goalsInput.value.trim();
            let customLength = null;

            if (!niche) { showMessage("Please enter a niche.", true); return; }

            const isProFeature = (platform !== 'General' || length !== 'short');
            if (isProFeature && !isPro) { openPaymentModal(); return; }
            
            if (length === 'custom') customLength = parseInt(customLengthInput.value);

            generateButton.disabled = true;
            loadingSpinner.classList.remove('hidden');
            outputArea.classList.add('hidden'); // Hide previous results while loading
            heroSection.classList.add('hidden'); // Hide hero

            try {
                const token = await auth.currentUser.getIdToken();
                const res = await fetch(API_PROXY_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify({ niche, tone, platform, length, customLength, goals, userId, appId })
                });
                
                if(!res.ok) {
                     const errData = await res.json().catch(() => ({}));
                     if(res.status === 403) openPaymentModal();
                     throw new Error(errData.error || "Generation failed.");
                }

                const data = await res.json();
                renderResults(data.text, niche, tone, length, platform, customLength);

            } catch (e) {
                showMessage(e.message, true);
                heroSection.classList.remove('hidden');
            } finally {
                generateButton.disabled = false;
                loadingSpinner.classList.add('hidden');
            }
        };

        function renderResults(text, niche, tone, length, platform, customLength) {
            outputArea.classList.remove('hidden');
            bioResults.innerHTML = '';
            
            const bios = text.split(/\d+\.\s?/).filter(b => b.trim().length > 0);
            
            bios.forEach(bio => {
                const safeBio = escapeHtml(bio.trim());
                const div = document.createElement('div');
                div.className = 'bg-white dark:bg-[#1e1f20] p-5 rounded-xl border border-gray-100 dark:border-gray-700 shadow-sm hover:shadow-md transition-all';
                div.innerHTML = `
                    <p class="text-gray-800 dark:text-gray-200 text-base leading-relaxed mb-4 font-medium">${safeBio}</p>
                    <div class="flex justify-between items-center pt-3 border-t border-gray-50 dark:border-gray-800">
                        <span class="text-xs text-gray-400 dark:text-gray-500">${safeBio.length} chars</span>
                        <div class="flex gap-3">
                            <button class="copy-btn text-xs font-bold text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>
                                Copy
                            </button>
                             <button class="save-btn text-xs font-bold text-emerald-600 dark:text-emerald-400 hover:text-emerald-800 dark:hover:text-emerald-300 flex items-center gap-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                Save
                            </button>
                        </div>
                    </div>
                `;
                
                div.querySelector('.copy-btn').onclick = () => copyToClipboard(bio.trim(), false);
                div.querySelector('.save-btn').onclick = async (e) => {
                    const btn = e.currentTarget;
                    if(btn.textContent.includes('Saved')) return;
                    try {
                        await addDoc(collection(db, `artifacts/${appId}/users/${userId}/bios`), {
                            bio: bio.trim(), niche, tone, platform, length, customLength, timestamp: serverTimestamp()
                        });
                        btn.innerHTML = '<span>Saved!</span>';
                        btn.classList.replace('text-emerald-600', 'text-gray-400');
                        btn.classList.replace('dark:text-emerald-400', 'dark:text-gray-500');
                    } catch(err) { showMessage("Save failed", true); }
                };
                bioResults.appendChild(div);
            });
            
            // Scroll results into view smoothly on mobile
            if(window.innerWidth < 768) outputArea.scrollIntoView({behavior: 'smooth'});
        }

        async function copyToClipboard(text, isHistory) {
             try {
                 await navigator.clipboard.writeText(text);
                 if(!isHistory) {
                    copyMessage.classList.remove('hidden');
                    setTimeout(() => copyMessage.classList.add('hidden'), 2000);
                 } else {
                     showMessage("Bio copied to clipboard!");
                 }
             } catch (e) {
                 showMessage("Copy failed. Please copy manually.", true);
             }
        }
    </script>
</body>
</html>
